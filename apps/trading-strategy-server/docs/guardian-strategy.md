# Guardian Strategy - 空單守護策略設計文檔

## 📅 背景與起因

**日期**: 2025-11-21

**市場狀況**:
- ETH 價格: 2,822 USDT
- 市場趨勢: 持續下跌
- 持倉成本: 3,041 USDT
- 未實現虧損: -1,412 USDT

**問題發現**:
1. 網格策略在無槓桿情況下各種盤勢都能盈利（已回測驗證）
2. 但實盤中使用了 3.2x 槓桿，違背了策略設計原則
3. 單向做多在下跌市場中承受較大壓力
4. 需要一種保護機制來降低單邊風險

## 🎯 核心理念

### 空單 = 保險，不是投機

**傳統雙向網格**: 多空同時進行，追求雙邊盈利
**守護者模式**: 空單只在多單虧損時啟動，目的是減損而非盈利

```
守護者策略定位：
- ✅ 是多單的保險
- ✅ 是風險對沖工具
- ✅ 是虧損減緩器
- ❌ 不是獨立盈利策略
- ❌ 不是反向投機
- ❌ 不能常開（有危險）
```

## 📊 策略設計

### 1. 觸發條件（三重確認）

空單守護只在以下條件**同時滿足**時啟動：

| 條件類型 | 具體指標 | 閾值 | 說明 |
|---------|---------|------|------|
| 虧損條件 | 多單浮虧 | > 500 USDT | 小虧損不需要保護 |
| 技術條件 | EMA20 < EMA50 | 死叉 | 確認下跌趨勢 |
| 動量條件 | 連續陰線 | ≥ 3 根 | 下跌動能增強 |

### 2. 倉位計算（動態對沖）

```python
對沖比例表：
├─ 虧損 < 500 USDT    → 0% 對沖（不需要保護）
├─ 虧損 500-1000 USDT → 30% 對沖（輕度保護）
├─ 虧損 1000-2000 USDT → 50% 對沖（中度保護）
└─ 虧損 > 2000 USDT   → 70% 對沖（最大保護）

註：永遠不要 100% 對沖，避免變成純粹的反向賭博
```

### 3. 進場策略（分批建倉）

```
第一層防護（虧損 > 500）:
└─ 開空 30% 計劃倉位

第二層防護（虧損 > 1000）:
└─ 加空 20% 計劃倉位

第三層防護（虧損 > 1500）:
└─ 加空 20% 計劃倉位

最大對沖: 70% 的多單倉位
```

### 4. 出場條件

| 出場信號 | 具體條件 | 執行動作 |
|---------|---------|---------|
| 任務完成 | 多單全部平倉 | 立即平掉所有空單 |
| 虧損縮小 | 多單虧損 < 300 USDT | 逐步減少空單 |
| 保護達標 | 空單盈利 > 多單虧損的 50% | 部分止盈空單 |
| 市場反轉 | 出現強勢反彈信號 | 立即平空避免虧損擴大 |

## 💡 實施細節

### 階段一：風險評估

```javascript
function assessRisk() {
    // 1. 計算當前多單總虧損
    const longLoss = calculateUnrealizedPnL(longPositions);

    // 2. 評估市場趨勢強度
    const trendStrength = {
        ema_divergence: (EMA20 - EMA50) / EMA50,
        consecutive_reds: countRedCandles(5),
        momentum: RSI
    };

    // 3. 決定保護等級
    if (longLoss < -500 && trendStrength.ema_divergence < -0.005) {
        return "NEED_PROTECTION";
    }

    return "SAFE";
}
```

### 階段二：倉位配置

```javascript
function calculateGuardianPosition() {
    const config = {
        maxHedgeRatio: 0.7,     // 最大對沖 70%
        minOrderSize: 100,       // 最小開單 100 USDT
        maxOrderSize: 5000,      // 單筆最大 5000 USDT
    };

    // 根據虧損程度決定對沖規模
    const hedgeSize = longPositionSize * getHedgeRatio(longLoss);

    // 分批設置
    return splitIntoOrders(hedgeSize, 3);
}
```

### 階段三：執行監控

```python
# 持續監控循環
while guardian_active:
    # 1. 檢查多單狀態
    if long_positions.empty():
        close_all_shorts()  # 多單平完，空單也平
        break

    # 2. 檢查保護效果
    total_pnl = long_pnl + short_pnl
    if total_pnl > -300:  # 總虧損控制在 300 以內
        reduce_short_positions(0.5)  # 減少一半空單

    # 3. 檢查反轉信號
    if detect_reversal_signal():
        close_all_shorts()  # 市場反轉，立即平空
        break

    sleep(60)  # 每分鐘檢查一次
```

## 📈 預期效果

### 情境模擬

#### 情境 1：持續下跌
```
初始: 多單虧損 -500 USDT
啟動: 開空 30% 對沖
下跌: 多單虧損擴大到 -1000，空單盈利 +150
結果: 淨虧損從 -1000 減少到 -850 (保護 15%)
```

#### 情境 2：下跌後反彈
```
初始: 多單虧損 -800 USDT
啟動: 開空 40% 對沖
反彈: 多單虧損縮小到 -400，空單虧損 -100
結果: 及時平空，總虧損 -500 (可接受範圍)
```

#### 情境 3：V 型反轉
```
初始: 多單虧損 -1000 USDT
啟動: 開空 50% 對沖
急跌: 空單快速盈利 +300
反轉: 檢測到強勢信號，立即平空鎖定 +300
結果: 用空單利潤彌補部分多單虧損
```

## ⚠️ 風險警示

### 必須避免的錯誤

1. **過度對沖**
   - ❌ 不要 100% 對沖（變成純做空）
   - ❌ 不要在恐慌中加倍對沖
   - ✅ 最大對沖比例 70%

2. **時機錯誤**
   - ❌ 不要在多單盈利時開空
   - ❌ 不要在橫盤時使用
   - ✅ 只在確認下跌趨勢時啟動

3. **忘記平倉**
   - ❌ 不要在多單平倉後還持有空單
   - ❌ 不要讓保護變成投機
   - ✅ 任務完成立即撤退

## 📝 實施檢查清單

### 啟動前檢查
- [ ] 多單虧損是否超過 500 USDT？
- [ ] 是否有明確的下跌趨勢？
- [ ] 是否已經降低槓桿到安全水平？
- [ ] 是否設置了最大對沖限制？

### 執行中監控
- [ ] 每小時檢查一次總體盈虧
- [ ] 監控空單與多單的盈虧比例
- [ ] 注意市場反轉信號
- [ ] 保持對沖比例在限制內

### 結束後覆盤
- [ ] 記錄保護效果（減少了多少虧損）
- [ ] 分析進出場時機是否合理
- [ ] 評估是否可以優化參數
- [ ] 總結經驗教訓

## 🎯 當前行動計劃（2025-11-21）

基於當前市場狀況和持倉：

### 立即執行（優先級 1）
1. **降低槓桿**
   - 當前: 3.2x
   - 目標: 2.0x 或以下
   - 方法: 平掉 6,000 USDT 多單

### 短期執行（優先級 2）
2. **建立守護倉位**
   - 等待反彈到 2,850-2,900
   - 分批開空 4,000-6,000 USDT
   - 設置止盈 0.5%，止損 1%

### 監控指標
3. **關鍵數據追蹤**
   - 總權益變化
   - 多空盈虧比
   - 槓桿率
   - 可用保證金

## 📚 參考資料

- [網格策略回測報告](../backtesting/CLAUDE.md)
- [主策略文檔](../CLAUDE.md)
- [風險管理原則](./risk-management.md)

## 🔄 文檔版本

- **創建日期**: 2025-11-21
- **最後更新**: 2025-11-21
- **版本**: 1.0.0
- **作者**: Trading System Team
- **審核狀態**: 待實盤驗證

## 📌 重要提醒

> **記住核心原則**：空單是保險，不是投機。目的是減少虧損，而不是反向賺錢。當多單安全時，守護者就該退場。

---