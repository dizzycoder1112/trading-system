# Trading System

é‡åŒ–äº¤æ˜“ç³»çµ±ï¼Œæ¡ç”¨åˆ†æ•£å¼ç³»çµ±æ¶æ§‹(å¾®æœå‹™)

## ç³»çµ±æ¶æ§‹

Dockerized Monorepo å¾®æœå‹™æ¶æ§‹ï¼ŒGolang + TypeScriptã€‚

### å°ˆæ¡ˆæ¶æ§‹

- **Monorepo**ï¼šä½¿ç”¨ Go Workspace (`go.work`) ç®¡ç†å¤šæœå‹™
- **å…±äº«æ¨¡çµ„**ï¼š`go-packages/` å­˜æ”¾é€šç”¨ç¨‹å¼ç¢¼ï¼ˆloggerã€shared domain ç­‰ï¼‰
- **ç¨ç«‹éƒ¨ç½²**ï¼šå„æœå‹™å¯ç¨ç«‹ç·¨è­¯ã€æ¸¬è©¦ã€éƒ¨ç½²

```
=== å³æ™‚äº¤æ˜“ç³»çµ± ===

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   SET/LPUSH  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ market-data â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             Redis               â”‚
â”‚   server    â”‚              â”‚  (Price Oracle / KV Store)      â”‚
â”‚    (Go)     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â–²
       â”‚                               â”‚ GET/LRANGE
       â–¼                  (optional)   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  OKX  â”‚                 â”‚                   â”‚
   â”‚  WS   â”‚                 â”‚                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜                 â–¼                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   trading-    â”‚â—€â”€â”€â”€â”‚   order-    â”‚
                    â”‚   strategy-   â”‚gRPCâ”‚   server    â”‚
                    â”‚    server     â”‚    â”‚    (Go)     â”‚
                    â”‚  (Go / DDD)   â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚  [Stateless]  â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â–¼
                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    Order è¼ªè©¢ Strategy è©¢å•é–‹å€‰å»ºè­°          â”‚  OKX   â”‚
    Strategy ç„¡ç‹€æ…‹ï¼Œåªè² è²¬è¨ˆç®—               â”‚  API   â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

=== å›æ¸¬ & è¦–è¦ºåŒ– (ç¨ç«‹) ===

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  export   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   trading-    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ chart-dashboard â”‚
â”‚   strategy-   â”‚  (JSON)   â”‚  (TypeScript)   â”‚
â”‚     server    â”‚           â”‚                 â”‚
â”‚               â”‚           â”‚  (Vite-React)   â”‚
â”‚               â”‚           â”‚                 â”‚
â”‚               â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   /backtest   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æœå‹™åˆ—è¡¨ (`apps/`)

| æœå‹™                        | èªè¨€       | æ¶æ§‹         | ç‹€æ…‹       | èªªæ˜                                     |
| --------------------------- | ---------- | ------------ | ---------- | ---------------------------------------- |
| **market-data-server**      | Go         | Layered      | ğŸŸ¢ Core    | OKX WebSocket å³æ™‚è¡Œæƒ…æ¥æ”¶ï¼Œå­˜å„²è‡³ Redis |
| **trading-strategy-server** | Go         | **DDD**      | ğŸŸ¢/ğŸŸ¡      | å›æ¸¬ç³»çµ± ğŸŸ¢ Core / ç­–ç•¥å¼•æ“ ğŸŸ¡ Scaffold  |
| **order-server**            | Go         | Layered      | âšª Planned | è¨‚å–®åŸ·è¡Œæœå‹™ï¼ˆåƒ… gRPC proto å®šç¾©ï¼‰       |
| **chart-dashboard**         | TypeScript | Vite + React | ğŸŸ¢ Core    | K ç·šåœ–è¡¨å‰ç«¯                             |

> **ç‹€æ…‹èªªæ˜**
>
> ğŸŸ¢ Core = æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼ŒæŒçºŒå„ªåŒ–ä¸­
>
> ğŸŸ¡ Scaffold = éª¨æ¶å»ºç«‹ï¼ŒåŠŸèƒ½é–‹ç™¼ä¸­
>
> âšª Planned = è¦åŠƒä¸­

> **é–‹ç™¼é‡å¿ƒ**
>
> ç›®å‰å°ˆæ³¨æ–¼**å›æ¸¬ç³»çµ±**çš„ç­–ç•¥é©—è­‰ï¼Œå¾…å›æ¸¬çµæœæ»¿æ„å¾Œï¼Œå†å°‡é‚è¼¯é·ç§»è‡³å³æ™‚ç­–ç•¥å¼•æ“ã€‚
>
> `backtest/` â†’ é©—è­‰å®Œæˆ â†’ `strategy/`

---

## è³‡æ–™æµèªªæ˜

### 1. market-data-server (Price Oracle)

**è·è²¬**ï¼šå³æ™‚è¡Œæƒ…æ¥æ”¶èˆ‡å­˜å„²

```
OKX WebSocket API
    â”‚
    â”‚ Subscribe: tickers, candles
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  market-data-server â”‚
â”‚                     â”‚
â”‚  â€¢ æ¥æ”¶å³æ™‚åƒ¹æ ¼       â”‚
â”‚  â€¢ æ¥æ”¶ K ç·šæ•¸æ“š      â”‚
â”‚  â€¢ æ ¼å¼åŒ–å¾Œå­˜å„²       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ SET / LPUSH
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis (KV Store)  â”‚
â”‚                     â”‚
â”‚  â€¢ price.latest.*   â”‚  â† String (SET)
â”‚  â€¢ candle.latest.*  â”‚  â† String (SET)
â”‚  â€¢ candle.history.* â”‚  â† List (LPUSH)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ GET / LRANGE (optional)
           â–¼
    å…¶ä»–æœå‹™å¯è®€å–
```

**Redis å­˜å„²**ï¼š
| Key Pattern | é¡å‹ | èªªæ˜ |
|-------------|------|-----|
| `price.latest.{instId}` | String | å³æ™‚åƒ¹æ ¼ (TTL 60s) |
| `candle.latest.{bar}.{instId}` | String | æœ€æ–° K ç·š (å‹•æ…‹ TTL) |
| `candle.history.{bar}.{instId}` | List | æ­·å² K ç·š (LPUSH, ä¿ç•™ N æ ¹) |

**å•Ÿå‹•**ï¼š

```bash
cd apps/market-data-server && go run ./cmd/main.go
```

> è©³ç´°é…ç½®èˆ‡æ¶æ§‹è«‹åƒè€ƒ [apps/market-data-server/README.md](./apps/market-data-server/README.md)

---

### 2. æ­·å²è³‡æ–™ä¸‹è¼‰å™¨ (scripts)

**è·è²¬**ï¼šä¸‹è¼‰ OKX æ­·å² K ç·šæ•¸æ“šï¼Œä¾›å›æ¸¬ä½¿ç”¨

```
OKX REST API
    â”‚
    â”‚ GET /api/v5/market/history-candles
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  download_okx_history   â”‚
â”‚                         â”‚
â”‚  â€¢ åˆ†é ä¸‹è¼‰æ­·å² K ç·š       â”‚
â”‚  â€¢ Rate Limit è™•ç†       â”‚
â”‚  â€¢ è‡ªå‹•é‡è©¦æ©Ÿåˆ¶           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Export
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     data/{æ—¥æœŸç¯„åœ}/     â”‚
â”‚     {instId}/{bar}/     â”‚
â”‚       history.json      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å•Ÿå‹•**ï¼š

```bash
pnpm install
pnpm download:okx \
  --inst-id=ETH-USDT-SWAP \
  --bar=5m \
  --after=2022-01-01T00:00:00Z \
  --before=2022-12-31T00:00:00Z
```

**è¼¸å‡ºæ ¼å¼**ï¼š

```
data/20220101-20221231/ETH-USDT-SWAP/5m/history.json
```

---

### 3. trading-strategy-server (ç­–ç•¥å¼•æ“ + å›æ¸¬ç³»çµ±)

**è·è²¬**ï¼šç­–ç•¥è¨ˆç®—èˆ‡ä¿¡è™Ÿç”Ÿæˆï¼ˆDDD æ¶æ§‹ï¼‰

#### ç­–ç•¥å¼•æ“ (å³æ™‚æ¨¡å¼)

> éœ€å…ˆå•Ÿå‹• `market-data-server` æ‰èƒ½å¾ Redis è®€å–åƒ¹æ ¼

```bash
cd apps/trading-strategy-server
cp .env.example .env
go run ./cmd/strategy/main.go
```

#### å›æ¸¬ç³»çµ±

```bash
cd apps/trading-strategy-server
go run ./cmd/backtest/main.go --data=../../data/xxx/history.json
```

æŸ¥çœ‹å®Œæ•´åƒæ•¸ï¼š`go run ./cmd/backtest/main.go --help`

> è©³ç´°èªªæ˜è«‹åƒè€ƒ [apps/trading-strategy-server/README.md](./apps/trading-strategy-server/README.md)

---

### 4. chart-dashboard (K ç·šåœ–è¡¨è¦–è¦ºåŒ–)

**è·è²¬**ï¼šå›æ¸¬çµæœè¦–è¦ºåŒ–ï¼Œé¡¯ç¤º K ç·šåœ–ã€äº¤æ˜“æ¨™è¨˜ã€å¹³å‡æˆæœ¬ç·š

```
å›æ¸¬çµæœ (CSV/JSON)
    â”‚
    â”‚ æ‹–æ›³ä¸Šå‚³
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    chart-dashboard      â”‚
â”‚                         â”‚
â”‚  â€¢ K ç·šåœ–è¡¨              â”‚
â”‚  â€¢ é–‹å€‰/å¹³å€‰æ¨™è¨˜          â”‚
â”‚  â€¢ å¹³å‡æˆæœ¬ç·š             â”‚
â”‚  â€¢ è³‡é‡‘æ›²ç·š              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å•Ÿå‹•**ï¼š

```bash
cd apps/chart-dashboard
pnpm install  # é¦–æ¬¡éœ€è¦å®‰è£ä¾è³´
pnpm dev      # å•Ÿå‹•é–‹ç™¼æœå‹™å™¨ (http://localhost:5173)
```

**ä½¿ç”¨æ–¹å¼**ï¼š

1. æº–å‚™æ•¸æ“šæ–‡ä»¶ï¼š`history.json`ï¼ˆK ç·šï¼‰+ `trades.csv`ï¼ˆäº¤æ˜“è¨˜éŒ„ï¼‰
2. å•Ÿå‹• chart-dashboard
3. åœ¨ã€Œæ•¸æ“šå°å…¥ã€å€å¡Šåˆ†åˆ¥è¼‰å…¥å…©å€‹æ–‡ä»¶
4. æŸ¥çœ‹ K ç·šåœ–ã€äº¤æ˜“æ¨™è¨˜èˆ‡å¹³å‡æˆæœ¬ç·š

**é è¦½**ï¼š

![Chart Dashboard æˆªåœ–](./apps/chart-dashboard/screenshot/screenshot.png)

> è©³ç´°èªªæ˜è«‹åƒè€ƒ [apps/chart-dashboard/README.md](./apps/chart-dashboard/README.md)
