# Trading System - QuantScalper

é‡åŒ–å‰é ­çš®äº¤æ˜“ç³»çµ±ï¼Œæ¡ç”¨å¾®æœå‹™æ¶æ§‹ + DDD è¨­è¨ˆã€‚

## ç­–ç•¥å®šä½

**QuantScalper** æ˜¯ä¸­é »é‡åŒ–çŸ­ç·šç­–ç•¥ï¼Œä¸æ˜¯é«˜é »äº¤æ˜“ (HFT)ã€‚

| ç‰¹å¾µ | é«˜é »äº¤æ˜“ (HFT) | QuantScalper |
|------|---------------|--------------|
| **æ±ºç­–é »ç‡** | æ¯«ç§’ç´šï¼Œæ¯ç§’æ•¸ç™¾æ¬¡ | æ¯ 5 åˆ†é˜ä¸€æ¬¡ |
| **æŒå€‰æ™‚é–“** | æ¯«ç§’~ç§’ | ç§’~å°æ™‚ |
| **å¹³å€‰æ–¹å¼** | ä¸»å‹•å¾®ç§’ç´šå¹³å€‰ | è¢«å‹•æ­¢ç›ˆè§¸ç™¼ |
| **åŸºç¤è¨­æ–½** | æ©Ÿæˆ¿è¨—ç®¡ã€FPGAã€å°ˆç·š | é›²æœå‹™å™¨ã€WebSocket |
| **ç«¶çˆ­ç¶­åº¦** | æ¯”èª°æ›´å¿« | æ¯”èª°åˆ¤æ–·æ›´æº– |

## æ ¸å¿ƒé‚è¼¯

æ¯ 5 åˆ†é˜ K ç·šæ”¶ç›¤æ™‚ï¼š
```
1. è¨ˆç®—é–‹å€‰é»ä½ = æ”¶ç›¤åƒ¹ Ã— 0.999ï¼ˆä½æ–¼å¸‚åƒ¹ 0.1%ï¼‰
2. æ›é™åƒ¹è²·å–® + å°æ‡‰æ­¢ç›ˆå–®
3. ç­‰å¾…æˆäº¤ï¼ˆè¢«å‹•æ›å–®ï¼‰
4. 5 åˆ†é˜å…§åªæŒæœ‰ä¸€å€‹å€‰ä½
5. æ­¢ç›ˆæˆäº¤å¾Œç«‹åˆ»å†é–‹æ–°å€‰ï¼ˆæœ€å¤§åŒ–äº¤æ˜“é‡ï¼‰
```

**è¨­è¨ˆç›®æ¨™**ï¼šé˜²å®ˆå‹ç­–ç•¥ï¼Œä¸»è¦æ”¶ç›Šä¾†è‡ª 40% æ‰‹çºŒè²»å›ä½£ï¼Œæ­¢ç›ˆæ˜¯ä¿è­·æ©Ÿåˆ¶ã€‚

## ç­–ç•¥ç‰¹å¾µ

| ç‰¹å¾µ | å‚³çµ± Grid | QuantScalper |
|------|----------|--------------|
| æ–¹å‘ | âŒ ç„¡æ–¹å‘æ€§ | ç´”åšå¤šï¼ˆåšç©ºç‚ºç¨ç«‹ç­–ç•¥ï¼‰ |
| é–‹å€‰é»ä½ | å›ºå®šåƒ¹æ ¼ç¶²æ ¼ç·š | å‹•æ…‹ï¼ˆæ”¶ç›¤åƒ¹ - 0.1%ï¼‰ |
| æ­¢ç›ˆæ–¹å¼ | å›ºå®šé–“è· | å‹•æ…‹æ­¢ç›ˆ (0.15%~0.2%) |
| é¿éšªæ©Ÿåˆ¶ | âŒ | âœ… ç´…Kéæ¿¾ï¼ˆè™§ææ™‚åªåœ¨ç´…Kæ”¶ç›¤é–‹å€‰ï¼‰ |
| é–‹å€‰ç¯€å¥ | åƒ¹æ ¼è§¸ç™¼ | å›ºå®šæ¯ 5 åˆ†é˜ä¸€å€‰ï¼ˆæ“¼æ‰‹çºŒè²»å›ä½£ï¼‰ |

## ç­–ç•¥åƒæ•¸

| åƒæ•¸ | å€¼ | èªªæ˜ |
|------|---|------|
| é–‹å€‰é»ä½ | æ”¶ç›¤åƒ¹ Ã— 0.999 | ä½æ–¼å¸‚åƒ¹ 0.1% æ›é™åƒ¹å–® |
| æ­¢ç›ˆç¯„åœ | 0.15% ~ 0.2% | å‹•æ…‹èª¿æ•´ï¼ˆåŸºæ–¼æ³¢å‹•ç‡ï¼‰ |
| å€‰ä½å¤§å° | $200 USDT | å›ºå®šå€‰ä½ |
| ç›ˆè™§å¹³è¡¡ | 1~20 USDT | ç¸½ç›ˆè™§é”æ¨™å‰‡é€€å‡º |

> **å‘½åèªªæ˜**ï¼šç¨‹å¼ç¢¼ä¸­ç­–ç•¥é¡å‹ç‚º `grid`ï¼Œå› ç‚º QuantScalper æœ¬è³ªä¸Šæ˜¯æ”¹è‰¯ç‰ˆç¶²æ ¼ç­–ç•¥ã€‚

---

## ç³»çµ±æ¶æ§‹

Dockerized Monorepo å¾®æœå‹™æ¶æ§‹ï¼ŒGolang + TypeScriptã€‚

```
=== å³æ™‚äº¤æ˜“ç³»çµ± ===

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   SET/LPUSH  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ market-data â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚             Redis               â”‚
â”‚   server    â”‚              â”‚  (Price Oracle / KV Store)      â”‚
â”‚    (Go)     â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                        â–²
       â”‚                               â”‚ GET/LRANGE
       â–¼                  (optional)   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  OKX  â”‚                 â”‚                   â”‚
   â”‚  WS   â”‚                 â”‚                   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”˜                 â–¼                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   trading-    â”‚â—€â”€â”€â”€â”‚   order-    â”‚
                    â”‚   strategy-   â”‚gRPCâ”‚   server    â”‚
                    â”‚    server     â”‚    â”‚    (Go)     â”‚
                    â”‚  (Go / DDD)   â”‚    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                    â”‚  [Stateless]  â”‚           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â–¼
                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    Order è¼ªè©¢ Strategy è©¢å•é–‹å€‰å»ºè­°          â”‚  OKX   â”‚
    Strategy ç„¡ç‹€æ…‹ï¼Œåªè² è²¬è¨ˆç®—               â”‚  API   â”‚
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜

=== å›æ¸¬ & è¦–è¦ºåŒ– (ç¨ç«‹) ===

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  export   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   trading-    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ chart-dashboard â”‚
â”‚   strategy-   â”‚  (JSON)   â”‚  (TypeScript)   â”‚
â”‚     server    â”‚           â”‚                 â”‚
â”‚               â”‚           â”‚  (Vite-React)   â”‚
â”‚               â”‚           â”‚                 â”‚
â”‚               â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   /backtest   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æœå‹™åˆ—è¡¨ (`apps/`)

| æœå‹™ | èªè¨€ | æ¶æ§‹ | ç‹€æ…‹ | èªªæ˜ |
|-----|------|-----|------|-----|
| **market-data-server** | Go | Layered | ğŸŸ¢ Core | OKX WebSocket å³æ™‚è¡Œæƒ…æ¥æ”¶ï¼Œå­˜å„²è‡³ Redis |
| **trading-strategy-server** | Go | **DDD** | ğŸŸ¢ Core | ç­–ç•¥å¼•æ“ + å›æ¸¬ç³»çµ± |
| **order-server** | Go | Layered | âšª Planned | è¨‚å–®åŸ·è¡Œæœå‹™ï¼ˆåƒ… gRPC proto å®šç¾©ï¼‰ |
| **chart-dashboard** | TypeScript | Vite + React | ğŸŸ¢ Core | K ç·šåœ–è¡¨å‰ç«¯ |

> **ç‹€æ…‹èªªæ˜**
>
> ğŸŸ¢ Core = æ ¸å¿ƒåŠŸèƒ½å®Œæˆï¼ŒæŒçºŒå„ªåŒ–ä¸­
>
> ğŸŸ¡ Scaffold = éª¨æ¶å»ºç«‹ï¼ŒåŠŸèƒ½é–‹ç™¼ä¸­
>
> âšª Planned = è¦åŠƒä¸­

> **é–‹ç™¼é‡å¿ƒ**
>
> ç›®å‰å°ˆæ³¨æ–¼**å›æ¸¬ç³»çµ±**çš„ç­–ç•¥é©—è­‰ï¼Œå¾…å›æ¸¬çµæœæ»¿æ„å¾Œï¼Œå†å°‡é‚è¼¯é·ç§»è‡³å³æ™‚ç­–ç•¥å¼•æ“ã€‚
>
> `backtest/` â†’ é©—è­‰å®Œæˆ â†’ `strategy/`

---

## è³‡æ–™æµèªªæ˜

### 1. market-data-server (Price Oracle)

**è·è²¬**ï¼šå³æ™‚è¡Œæƒ…æ¥æ”¶èˆ‡å­˜å„²

```
OKX WebSocket API
    â”‚
    â”‚ Subscribe: tickers, candles
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  market-data-server â”‚
â”‚                     â”‚
â”‚  â€¢ æ¥æ”¶å³æ™‚åƒ¹æ ¼       â”‚
â”‚  â€¢ æ¥æ”¶ K ç·šæ•¸æ“š      â”‚
â”‚  â€¢ æ ¼å¼åŒ–å¾Œå­˜å„²       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ SET / LPUSH
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Redis (KV Store)  â”‚
â”‚                     â”‚
â”‚  â€¢ price.latest.*   â”‚  â† String (SET)
â”‚  â€¢ candle.latest.*  â”‚  â† String (SET)
â”‚  â€¢ candle.history.* â”‚  â† List (LPUSH)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ GET / LRANGE (optional)
           â–¼
    å…¶ä»–æœå‹™å¯è®€å–
```

**Redis å­˜å„²**ï¼š
| Key Pattern | é¡å‹ | èªªæ˜ |
|-------------|------|-----|
| `price.latest.{instId}` | String | å³æ™‚åƒ¹æ ¼ (TTL 60s) |
| `candle.latest.{bar}.{instId}` | String | æœ€æ–° K ç·š (å‹•æ…‹ TTL) |
| `candle.history.{bar}.{instId}` | List | æ­·å² K ç·š (LPUSH, ä¿ç•™ N æ ¹) |

**å•Ÿå‹•**ï¼š
```bash
cd apps/market-data-server && go run ./cmd/main.go
```

> è©³ç´°é…ç½®èˆ‡æ¶æ§‹è«‹åƒè€ƒ [apps/market-data-server/README.md](./apps/market-data-server/README.md)

---

### 2. æ­·å²è³‡æ–™ä¸‹è¼‰å™¨ (scripts)

**è·è²¬**ï¼šä¸‹è¼‰ OKX æ­·å² K ç·šæ•¸æ“šï¼Œä¾›å›æ¸¬ä½¿ç”¨

```
OKX REST API
    â”‚
    â”‚ GET /api/v5/market/history-candles
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  download_okx_history   â”‚
â”‚                         â”‚
â”‚  â€¢ åˆ†é ä¸‹è¼‰æ­·å² K ç·š       â”‚
â”‚  â€¢ Rate Limit è™•ç†       â”‚
â”‚  â€¢ è‡ªå‹•é‡è©¦æ©Ÿåˆ¶           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ Export
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     data/{æ—¥æœŸç¯„åœ}/     â”‚
â”‚     {instId}/{bar}/     â”‚
â”‚       history.json      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å•Ÿå‹•**ï¼š
```bash
pnpm download:okx \
  --inst-id=ETH-USDT-SWAP \
  --bar=5m \
  --after=2022-01-01T00:00:00Z \
  --before=2022-12-31T00:00:00Z
```

**è¼¸å‡ºæ ¼å¼**ï¼š
```
data/20220101-20221231/ETH-USDT-SWAP/5m/history.json
```

---

### 3. trading-strategy-server (ç­–ç•¥å¼•æ“ + å›æ¸¬ç³»çµ±)

**è·è²¬**ï¼šç­–ç•¥è¨ˆç®—èˆ‡ä¿¡è™Ÿç”Ÿæˆï¼ˆDDD æ¶æ§‹ï¼‰

#### ç­–ç•¥å¼•æ“ (å³æ™‚æ¨¡å¼)

> éœ€å…ˆå•Ÿå‹• `market-data-server` æ‰èƒ½å¾ Redis è®€å–åƒ¹æ ¼

```bash
cd apps/trading-strategy-server
cp .env.example .env
go run ./cmd/strategy/main.go
```

#### å›æ¸¬ç³»çµ±

```bash
cd apps/trading-strategy-server
go run ./cmd/backtest/main.go --data=../../data/xxx/history.json
```

æŸ¥çœ‹å®Œæ•´åƒæ•¸ï¼š`go run ./cmd/backtest/main.go --help`

> è©³ç´°æ¶æ§‹è«‹åƒè€ƒ [apps/trading-strategy-server/CLAUDE.md](./apps/trading-strategy-server/CLAUDE.md)

